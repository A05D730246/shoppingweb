<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Login Page</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
</head>
<body>
<div class="container">
    <h2>Login Form</h2>
    <form th:action="@{/login}" method="post">
		<div class="form-group">
            <label for="email">Email:</label>
            <input type="email" class="form-control" id="email" placeholder="Enter email" name="email"
                   pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}">
            <small class="form-text text-muted">Please enter a Valid email address.(xx@yy.zz)</small>
            <div th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="text-danger"></div>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <div class="input-group">
                <input type="password" class="form-control" id="password" placeholder="Enter password" name="password"
                       th:attr="pattern='(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}'"
                       oninput="checkPassword(this);">
                <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="button" id="togglePassword">Show</button>
                </div>
            </div>
            <small class="form-text text-muted">Password must be at least 8 characters and contain one Digit and one Uppercase and Lowercase letter.</small>
        </div>
        <div class="form-group">
            <label for="captcha">驗證碼 Captcha:</label>
            <div class="input-group">
                <input type="text" class="form-control" id="captcha" placeholder="Enter captcha" name="captcha">
                <div class="input-group-append">
                    <span class="input-group-text" id="captchaLabel"></span>
                </div>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Login</button>
    </form>
</div>
<script>
	var captcha = '';
	function generateCaptcha() {
    	captcha = '';
    	var characters = '23456789abcdABCD';
    	var charactersLength = characters.length;
    	for (var i = 0; i < 4; i++) 
        	captcha += characters.charAt(Math.floor(Math.random() * charactersLength));
    	document.getElementById('captchaLabel').innerText = captcha;
	}
    function checkCaptcha() {
        var inputCaptcha = document.getElementById('captcha').value;
        var labelCaptcha = document.getElementById('captchaLabel').innerText;
        if (inputCaptcha !== labelCaptcha) {
            document.getElementById('captcha').style.color = 'red';
        } else {
            document.getElementById('captcha').style.color = 'black';
        }
    }

    function checkPassword(input) {
        var password = input.value;
        var passwordRegex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$/;
        if (passwordRegex.test(password)) {
            input.style.color = 'black';
        } else {
            input.style.color = 'red';
        }
/*
至少包含一個數字（(?=.*\d)）
至少包含一個小寫字母（(?=.*[a-z])）
至少包含一個大寫字母（(?=.*[A-Z])）
至少包含8個或更多的字符（.{8,}）
*/
    }

    // Generate captcha, check it and email format when the page loads
    window.onload = function() {
        generateCaptcha();
        document.getElementById('captcha').addEventListener('input', checkCaptcha);
    };
</script>
</body>
</html>
